<odoo>
  <data>
  
    <!-- Top menu item -->
    <menuitem id='menu_missions' name='Missions' sequence="105" groups="group_missions_user" web_icon="ps_missions,static/description/icon.png"/>
    <menuitem name="Operations" parent="menu_missions" id="menu_missions_operations" sequence="50" />
    <menuitem name="Manager" parent="menu_missions" id="menu_missions_admin" sequence="51" groups="group_missions_manager"/>
    <menuitem name="Configuration" parent="menu_missions" id="menu_missions_config" sequence="53" groups="group_missions_manager"/>
      
    <!-- explicit list view definition -->
    
    <record model="ir.ui.view" id="pops_measurement_list">
      <field name="name">pops.measurement.list</field>
      <field name="model">pops.measurement</field>
      <field name="arch" type="xml">
        <tree>
          <field name="name"/>
          <field name="user_id"/>
          <field name="date_started"/>
          <field name="date_finished"/>
          <field name="measurement_latitude"/>
          <field name="measurement_longitude"/>
          <field name="state"/>          
        </tree>
      </field>
    </record>
    
    <record model="ir.ui.view" id="pops_measurement_form">
      <field name="name">pops.measurement.form</field>
      <field name="model">pops.measurement</field>
      <field name="arch" type="xml">
        <form>
        	<header>
				    <field name="state" widget="statusbar" statusbar_visible="draft,ordered,doing,done" clickable="True"/>
          </header>        
        	<sheet>        		
        		<group>
        			<grpup>
	        			<field name="name"/>
	          			<field name="user_id"/>
	          		</grpup>
	          		<group>
		          		<field name="date_started"/>
		          		<field name="date_finished"/>
		          	</group>	          		
	          	</group>
	          	<group>
       				<field name="measurement_latitude"/>
       				<field name="measurement_longitude"/>
	          	</group>
	          	<group>
	          		<field name="missions_id"/>
	          	</group>
	          		
	          	<notebook>
	          		<page string="Measurement Lines" name="measurement_lines" attrs="{'invisible':True}">
                  <field name="lines_ids" attrs="{'readonly': [('state', 'in', ('done'))]}">
                    <form string="Hitos">
                      <field name="type"/>
                      <field name="name"/>
                      <field name="answer"/>
                      <field name="photo"/>
                      <field name="photo_name"/>	                       	
                    </form>
                    <tree string="Hitos" editable="bottom">
                      <field name="type"/>
                      <field name="name"/>
                      <field name="answer"/>
                        <field name="photo_name" invisible="1" />
                        <field name="photo" filename="photo_name" widget="binary"/>	                       		
                    </tree>          		
	      				  </field>
	          		</page>
	          		<page string="Maps" name="measurement_maps" attrs="{'invisible':True}">
	          			<group>
	          				<field name="google_map_measurement" widget="map" nolabel="1"/>	
	          			</group>	          		
	          		</page>
                <page string="Measurement Quizz Lines" name="measurement_quizzlines">
                  <field name="quizz_lines_ids" attrs="{'readonly': [('state', 'in', ('done'))]}">
                    <form string="Hitos">
                      <field name="quizz_id"/>
                      <field name="alternative_id"/>
                    </form>
                    <tree string="Hitos" editable="bottom">
                      <field name="quizz_id"/>
                      <field name="alternative_id"/>
                    </tree>
	      				  </field>
                </page>
                <page string="Measurement Photo Lines" name="measurement_photolines">
                  <field name="photo_lines_ids" attrs="{'readonly': [('state', 'in', ('done'))]}">
                    <form string="Hitos">
                      <field name="name"/>
                      <field name="photo_id"/>
                      <field name="photo" widget="image"/>
                    </form>
                    <tree string="Hitos" editable="bottom">
                      <field name="name"/>
                      <field name="photo_id"/>
                      <field name="photo" widget="image"/>
                    </tree>
	      				  </field>
                </page>
	          	</notebook>   
              <group>
                <field name="approved" attrs="{'invisible': [('state', 'not in', ('done'))]}"/>
                <field name="paid" attrs="{'invisible': [('approved', '==', (False))]}"/>
              </group>	         		          	
          	</sheet>          
        </form>
      </field>
    </record> 
    
    <record model="ir.ui.view" id="pops_measurement_filter">
	    <field name="name">pops.measurement.filter</field>
	    <field name="model">pops.measurement</field>
	    <field name="arch" type="xml">
	        <search string="Search Measurements">
	            <field name="name" string="Measurements"/>
	            <field name="state"/>
                <group expand="0" string="Group By">
                	<filter string="User" name="user_id" domain="[]" context="{'group_by':'user_id'}"/>
               	</group>	            
	        </search>	    
	    </field>
    </record>       
       
    <!-- Measurement Kanban View -->
    <record model="ir.ui.view" id="view_task_kanban">
       <field name="name">pops.measurement.kanban</field>
       <field name="model">pops.measurement</field>
       <field name="arch" type="xml">
           <kanban default_group_by="state" class="o_kanban_small_column o_kanban_project_tasks" on_create="quick_create" 
            quick_create_view="ps_missions.quick_create_measurement_form" examples="project">
               <field name="color"/>
               <field name="priority"/>
               <field name="state" options='{"group_by_tooltip": {"description": "Stage Description", 
                "legend_priority": "Use of stars"}}'/>
               <field name="user_id"/>
               <field name="date_started"/>
               <field name="date_finished"/>
               <field name="sequence"/>
               <field name="measurement_latitude"/>
               <field name="measurement_longitude"/>
               <field name="active"/>
               <field name="legend_blocked"/>
               <field name="legend_normal"/>
               <field name="legend_done"/>
               <field name="legend_doing"/>
               <field name="partner_id"/>
               <progressbar field="kanban_state" colors='{"done": "success", "blocked": "danger"}'/>
               <templates>
               <t t-name="kanban-box">
                   <div t-attf-class="oe_kanban_color_#{kanban_getcolor(record.color.raw_value)} oe_kanban_card 
                    oe_kanban_global_click">
                       <div class="oe_kanban_content">
                           <div class="o_kanban_record_top">
                               <div class="o_kanban_record_headings">
                                   <strong class="o_kanban_record_title"><field name="name"/></strong><br/>
                                   <small class="o_kanban_record_subtitle text-muted">
                                       <field name="missions_id" invisible="context.get('default_missions_id', False)"/>
                                       <!-- 
                                       <t t-if="record.date_date_started.raw_value and record.date_date_started.raw_value lt (new Date())" t-set="red">oe_kanban_text_red</t>
                                       <t t-if="record.date_finished.raw_value and record.date_finished.raw_value lt (new Date())" t-set="red">oe_kanban_text_green</t>
                                        -->
                                       <span t-attf-class="#{red || ''}"><i><field name="date_finished"/></i></span>
                                       <t t-if="record.partner_id"><span><field name="partner_id"/></span></t>
                                   </small>
                               </div>
                               <div class="o_dropdown_kanban dropdown" groups="base.group_user">
                                   <a role="button" class="dropdown-toggle o-no-caret btn" data-toggle="dropdown" href="#" 
                                    aria-label="Dropdown menu" title="Dropdown menu">
                                       <span class="fa fa-ellipsis-v"/>
                                   </a>
                                   <div class="dropdown-menu" role="menu">
                                       <a t-if="widget.editable" role="menuitem" type="set_cover" class="dropdown-item">Set Cover Image</a>
                                       <a t-if="widget.editable" role="menuitem" type="edit" class="dropdown-item">Edit Task</a>
                                       <a t-if="widget.deletable" role="menuitem" type="delete" class="dropdown-item">Delete</a>
                                       <div role="separator" class="dropdown-divider"></div>
                                       <ul class="oe_kanban_colorpicker" data-field="color"/>
                                   </div>
                               </div>
                           </div>
                           <!-- 
                           <div class="o_kanban_record_body">
                               <field name="tag_ids" widget="many2many_tags" options="{'color_field': 'color'}"/>
                               <div t-if="record.displayed_image_id.value">
                                   <field name="displayed_image_id" widget="attachment_image"/>
                               </div>
                           </div>
                            -->
                           <div class="o_kanban_record_bottom">
                               <div class="oe_kanban_bottom_left">
                                   <field name="priority" widget="priority"/>
                                   <!-- 
                                   <field name="activity_ids" widget="kanban_activity"/>
                                    -->
                                    <!-- 
                                   <t t-if="record.message_needaction_counter.raw_value">
                                       <span role="alert" class='oe_kanban_mail_new' title='Unread Messages'><i class='fa fa-comments' role="img" aria-label="Unread Messages"/><t t-raw="record.message_needaction_counter.raw_value"/></span>
                                   </t>
                                    -->
                                   <!-- 
                                   <b t-if="record.rating_ids.raw_value.length">
                                       <span style="font-weight:bold;" class="fa fa-fw mt4 fa-smile-o text-success" t-if="record.rating_last_value.value == 10" title="Latest Rating: Satisfied" role="img" aria-label="Happy face"/>
                                       <span style="font-weight:bold;" class="fa fa-fw mt4 fa-meh-o text-warning" t-if="record.rating_last_value.value == 5" title="Latest Rating: Not Satisfied" role="img" aria-label="Neutral face"/>
                                       <span style="font-weight:bold;" class="fa fa-fw mt4 fa-frown-o text-danger" t-if="record.rating_last_value.value == 1" title="Latest Rating: Higly Dissatisfied" role="img" aria-label="Sad face"/>
                                   </b>
                                    -->
                               </div>
                               <div class="oe_kanban_bottom_right">
                                   <field name="kanban_state" widget="state_selection" groups="base.group_user"/>
                                   <img t-att-src="kanban_image('res.users', 'image_small', record.user_id.raw_value)" 
                                    t-att-title="record.user_id.value" t-att-alt="record.user_id.value" width="24" 
                                    height="24" class="oe_kanban_avatar"/>
                               </div>
                           </div>
                       </div>
                       <div class="oe_clear"></div>
                   </div>
               </t>
               </templates>
           </kanban>
       </field>
    </record>
    
    <record id="quick_create_measurement_form" model="ir.ui.view">
        <field name="name">pops.measurementform.quick_create</field>
        <field name="model">pops.measurement</field>
        <field name="priority">1000</field>
        <field name="arch" type="xml">
            <form>
                <group>
                    <field name="name" string = "Measurement Title"/>
                    <field name="user_id" options="{'no_open': True,'no_create': True}"/>
                </group>
            </form>
        </field>
    </record>    
    
    <!-- 
    <record id="action_measurement_tree" model="ir.actions.act_window">
       <field name="name">Measurements</field>
       <field name="type">ir.actions.act_window</field>
       <field name="res_model">pops.measurement</field>
       <field name="view_type">form</field>
       <field name="view_mode">kanban,tree,form</field>
       <field name="search_view_id" ref="pops_measurement_filter"/>
       <field name="help" type="html">
         <p class="o_view_nocontent_create">
           Create a new measuments
         </p>
       </field>
   </record>
    -->  
   
   <record id="action_view_measuments" model="ir.actions.act_window">
       <field name="name">Measuments</field>
       <field name="res_model">pops.measurement</field>
       <field name="view_mode">kanban,tree,form</field>
       <field name="search_view_id" ref="pops_measurement_filter"/>
       <field name="help" type="html">
           <p class="o_view_nocontent_create">
              Create a new Measurement
           </p>
       </field>
   </record>
   
   <record id="open_view_measuments_list_kanban" model="ir.actions.act_window.view">
       <field name="sequence" eval="0"/>
       <field name="view_mode">kanban</field>
       <field name="act_window_id" ref="action_view_measuments"/>
   </record>
   
   <record id="open_view_measuments_list_tree" model="ir.actions.act_window.view">
       <field name="sequence" eval="1"/>
       <field name="view_mode">tree</field>
       <field name="act_window_id" ref="action_view_measuments"/>
   </record>            

   <menuitem action="action_view_measuments" id="menu_misions_measurement" parent="menu_missions_operations" 
    name="Measurements" sequence="16"/>
   
   <record id="action_open_missions_measurement" model="ir.actions.act_window">
       <field name="context">{'search_default_missions_id': [active_id], 'default_missions_id': active_id}</field>
       <field name="name">measurement</field>
       <field name="res_model">pops.measurement</field>
   </record>   
   
	<!-- missions models -->
	
    <record model="ir.ui.view" id="pops_measurement_list">
      <field name="name">pops.missions.list</field>
      <field name="model">pops.missions</field>
     <field name="arch" type="xml">
        <tree>
          <field name="name"/>
          <field name="subject"/>
          <field name="partner_id"/>
          <field name="establishment_id"/>
          <field name="email"/>
          <field name="priority"/>
          <field name="state"/>
        </tree>
      </field>
    </record>

    <record model="ir.ui.view" id="pops_missions_form">
      <field name="name">pops.missions.form</field>
      <field name="model">pops.missions</field>
     <field name="arch" type="xml">
        <form>
        	<header>
				    <field name="state" widget="statusbar" statusbar_visible="draft,open,reopen,close" clickable="True"/>
          </header>        
        	<sheet>    
            <div class="oe_button_box" name="button_box">
              <button class="oe_stat_button" type="action" name="%(action_open_missions_measurement)d"
                  groups="ps_missions.group_missions_user"
                  icon="fa-book" title="Measurement count">
                  <field string="Measurement" name="measurement_count" widget="statinfo"/>
              </button>                    
            </div>        	 
            <div class="oe_title">
              <h1>
                <field name="name" default_focus="1" placeholder="Mission Number"/>
              </h1>
            </div>		
            <group>
              <group col="2" colspan="6">
                <field name="subject"/>
              </group>	        	
              <group col="2">          		
                <field name="partner_id"/>
                <field name="establishment_id"/>  
              </group>
              <group col="2">
                <field name="contract"/>
                <field name="account_anality"/>
                <field name="create_by_user_id"/>
              </group>
              <group col="2">
                <field name="date_create"/>
                <field name="date_finished"/>
              </group>
              <group col="2">
                <field name="scores"/>
                <field name="reward"/>
              </group>
              <group col="2">
                <field name="closed"/>
                <field name="limit"/>
              </group>
              <group col="2" colspan="6">
                <field name="type_mission"/>
              </group>
              <group col="2" colspan="6">
                <field name="instructions"/>
              </group>
	          </group>

            <notebook>
              <page string="Photos" name="photo_lines" attrs="{'invisible':[('type_mission', '==', 'quizz')]}">
                <field name="photo_ids" attrs="{'readonly': [('closed', '==', (True))]}">
                  <form string="Hitos">
                    <field name="name"/>
                  </form>
                  <tree string="Hitos" editable="bottom">
                    <field name="name"/>
                  </tree>          		
	      				</field>
	          	</page>
              <page string="Quizz" name="quizzes" attrs="{'invisible':[('type_mission', '==', 'photo')]}">
                <field name="quizz_ids" attrs="{'readonly': [('closed', '==', (True))]}">
                  <form string="Hitos">
                    <field name="name"/>
                  </form>
                  <tree string="Hitos" editable="bottom">
                    <field name="name"/>
                  </tree>          		
	      				</field>
              </page>
            </notebook>

            <group>
              <field name="mission_map" widget="map" nolabel="1"/>
              <div id="mapa"></div>
            </group>
          </sheet>          
        </form>
      </field>
    </record> 
    
    <record model="ir.ui.view" id="pops_missions_filter">
	    <field name="name">pops.missions.filter</field>
	    <field name="model">pops.missions</field>
	    <field name="arch" type="xml">
	        <search string="Search Missions">
	            <field name="name" string="Missions"/>
	            <field name="state"/>
	            <field name="partner_id"/>
                <group expand="0" string="Group By">
                	<filter string="Create User" name="create_by_user_id" domain="[]" context="{'group_by':'create_by_user_id'}"/>
                	<filter string="Partner" name="partner_id" domain="[]" context="{'group_by':'partner_id'}"/>
               	</group>	            
	        </search>	    
	    </field>
    </record>       
    
    <record id="action_missions_tree" model="ir.actions.act_window">
       <field name="name">Missions</field>
       <field name="type">ir.actions.act_window</field>
       <field name="res_model">pops.missions</field>
       <field name="view_type">form</field>
       <field name="view_mode">tree,form</field>
       <field name="search_view_id" ref="pops_missions_filter"/>
       <field name="help" type="html">
         <p class="o_view_nocontent_create">
           Create a new mission
         </p>
       </field>
        
   </record>

   <menuitem action="action_missions_tree" id="menu_misions_missions" parent="menu_missions_operations" name="Missions" 
    sequence="6"/>
   
   <record id="action_open_partner_missions" model="ir.actions.act_window">
       <field name="context">{'search_default_partner_id': [active_id], 'default_partner_id': active_id}</field>
       <field name="name">missions</field>
       <field name="res_model">pops.missions</field>
   </record>   
   
   <record model="ir.ui.view" id="partner_view_button_missions_count">
       <field name="name">partner.view.button.missions_count</field>
       <field name="model">res.partner</field>
       <field name="inherit_id" ref="base.view_partner_form" />
       <field name="priority" eval="14"/>
       <field name="groups_id" eval="[(4, ref('ps_missions.group_missions_user'))]"/>
       <field name="arch" type="xml">
           <button name="toggle_active" position="before">
               <button class="oe_stat_button" type="action" name="%(action_open_partner_missions)d"
                   groups="ps_missions.group_missions_user"
                   icon="fa-book" title="Missions">
                   <field string="Missions" name="missions_count" widget="statinfo"/>
               </button>
           </button>
       </field>
   </record>   
   
   <menuitem id="menu_missions_customer" name="Customers"
       parent="menu_missions_operations"
       action="base.action_partner_customer_form" sequence="110"/>            	       

    <!-- actions opening views on models -->
    <!--
    <record model="ir.actions.act_window" id="dsa_modulo.action_window">
      <field name="name">dsa_modulo window</field>
      <field name="res_model">dsa_modulo.dsa_modulo</field>
      <field name="view_mode">tree,form</field>
    </record>f0dba8ee7390bc6a3b01f9b2d1c942ba212daab338713e89780ad4cb0c7f79aa
    -->

    <!-- server action to the one above -->
    <!--
    <record model="ir.actions.server" id="dsa_modulo.action_server">
      <field name="name">dsa_modulo server</field>
      <field name="model_id" ref="model_dsa_modulo_dsa_modulo"/>
      <field name="code">
        action = {
          "type": "ir.actions.act_window",
          "view_mode": "tree,form",
          "res_model": self._name,
        }
      </field>
    </record>
    -->

    <!-- Top menu item -->
    
    <!-- <menuitem name="dsa_modulo" id="dsa_modulo.menu_root"/> -->
   
    <!-- menu categories -->
    
    <!-- <menuitem name="Menu 1" id="dsa_modulo.menu_1" parent="dsa_modulo.menu_root"/>
    <menuitem name="Menu 2" id="dsa_modulo.menu_2" parent="dsa_modulo.menu_root"/>
    -->
    <!-- actions -->
    
    <!-- <menuitem name="List" id="dsa_modulo.menu_1_list" parent="dsa_modulo.menu_1"
              action="dsa_modulo.action_window"/>
    <menuitem name="Server to list" id="dsa_modulo" parent="dsa_modulo.menu_2"
              action="dsa_modulo.action_server"/>
    -->

    <!-- quizz -->
    <record id="pops_quizz_form" model="ir.ui.view" >
      <field name="name">pops.quizz.form</field>
      <field name="model">pops.quizz</field>
      <field name="arch" type="xml">
        <form>
        	<sheet> 
                <grpup>
                    <field name="name"/>
                </grpup>
                <group>
	          		<field name="missions_id"/>
	          	</group>
                <notebook>
                    <page string="Quizz Lines" name="quizz_lines">
                        <field name="quizz_line_ids" readonly="False">
                            <form string="Hitos">
                                <field name="alternative_id"/>
                                <field name="correct"/>
                            </form>
                            <tree string="Hitos" editable="bottom">
                                <field name="alternative_id"/>
                                <field name="correct"/>
                            </tree>          		
                        </field>
                    </page>
                </notebook>        
          	</sheet>          
        </form>
      </field>
    </record> 

    <record model="ir.ui.view" id="pops_quizz_filter">
	    <field name="name">pops.quizz.filter</field>
	    <field name="model">pops.quizz</field>
	    <field name="arch" type="xml">
	        <search string="Search Quizzes">
	            <field name="name" string="Quizz"/>            
	        </search>	    
	    </field>
    </record>

    <record id="action_view_quizz" model="ir.actions.act_window">
       <field name="name">Quizz</field>
       <field name="type">ir.actions.act_window</field>
       <field name="res_model">pops.quizz</field>
       <field name="view_type">form</field>
       <field name="view_mode">tree,form</field>
       <field name="search_view_id" ref="pops_quizz_filter"/>
       <field name="help" type="html">
         <p class="o_view_nocontent_create">
           Create a new Quizz
         </p>
       </field>
    </record>

    <menuitem action="action_view_quizz" id="menu_misions_quizz" parent="menu_missions_operations" name="Quizz" 
    sequence="7"/>

    <!-- alternative -->
    <record id="pops_alternative_form" model="ir.ui.view" >
      <field name="name">pops.alternative.form</field>
      <field name="model">pops.alternative</field>
      <field name="arch" type="xml">
        <form>
        	<sheet> 
                <grpup>
                    <field name="name"/>
                </grpup>
          	</sheet>          
        </form>
      </field>
    </record> 

    <record model="ir.ui.view" id="pops_alternative_filter">
	    <field name="name">pops.alternative.filter</field>
	    <field name="model">pops.alternative</field>
	    <field name="arch" type="xml">
	        <search string="Search Alternatives">
	            <field name="name" string="Alternative"/>            
	        </search>	    
	    </field>
    </record>


    <record id="action_view_alternative" model="ir.actions.act_window">
       <field name="name">Alternative</field>
       <field name="type">ir.actions.act_window</field>
       <field name="res_model">pops.alternative</field>
       <field name="view_type">form</field>
       <field name="view_mode">tree,form</field>
       <field name="search_view_id" ref="pops_alternative_filter"/>
       <field name="help" type="html">
         <p class="o_view_nocontent_create">
           Create a new Alternative
         </p>
       </field>
    </record>

    <menuitem action="action_view_alternative" id="menu_misions_alternative" parent="menu_missions_operations" name="Alternatives" 
    sequence="8"/>

    <!-- establishment -->

    <record id="pops_establishment_form" model="ir.ui.view" >
      <field name="name">pops.establishment.form</field>
      <field name="model">pops.establishment</field>
      <field name="arch" type="xml">
        <form>
        	<sheet> 
            <grpup>
              <group>
                <field name="name"/>
                <field name="zip_code"/>
                <field name="address"/>
                <field name="neighbor"/>
                <field name="city"/>
                <field name="state"/>
                <field name="latitude"/>
                <field name="longitude"/>
              </group>
            </grpup>
          </sheet>          
        </form>
      </field>
    </record> 

    <record model="ir.ui.view" id="pops_establishment_filter">
	    <field name="name">pops.establishment.filter</field>
	    <field name="model">pops.establishment</field>
	    <field name="arch" type="xml">
	        <search string="Search Establishments">
	            <field name="name" string="Establishment"/>            
	        </search>	    
	    </field>
    </record>

    <record id="action_view_establishment" model="ir.actions.act_window">
       <field name="name">Establishment</field>
       <field name="type">ir.actions.act_window</field>
       <field name="res_model">pops.establishment</field>
       <field name="view_type">form</field>
       <field name="view_mode">tree,form</field>
       <field name="search_view_id" ref="pops_establishment_filter"/>
       <field name="help" type="html">
         <p class="o_view_nocontent_create">
           Create a new Establishment
         </p>
       </field>
    </record>

    <menuitem action="action_view_establishment" id="menu_misions_establishment" parent="menu_missions_operations" name="Establishments" 
    sequence="9"/>

  </data>
</odoo>